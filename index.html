<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Athena - The Ultimate Learning Adventure for Ages 2-17">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Athena - Learning Adventure</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle'>üåü</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkF0aGVuYSIsCiAgInNob3J0X25hbWUiOiAiQXRoZW5hIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjNjM2NmYxIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3JlY3QgZmlsbD0nJTIzNjM2NmYxJyB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgcng9JzIwJyUyRiUzRSUzdGN0ZXh0IHg9JzUwJyUyNSB5PSc2NSclMjUgZm9udC1zaXplPSc1MCclMjUgdGV4dC1hbmNob3I9J21pZGRsZSclMjU+JTIzMTI5MzY1JTNDL3RleHQlM0UlM0Mvc3ZnPiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3JlY3QgZmlsbD0nJTIzNjM2NmYxJyB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgcng9JzIwJyUyRiUzRSUzdGN0ZXh0IHg9JzUwJyUyNSB5PSc2NSclMjUgZm9udC1zaXplPSc1MCclMjUgdGV4dC1hbmNob3I9J21pZGRsZSclMjU+JTIzMTI5MzY1JTNDL3RleHQlM0UlM0Mvc3ZnPiIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3JlY3QgZmlsbD0nJTIzNjM2NmYxJyB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgcng9JzIwJyUyRiUzRSUzdGN0ZXh0IHg9JzUwJyUyNSB5PSc2NSclMjUgZm9udC1zaXplPSc1MCclMjUgdGV4dC1hbmNob3I9J21pZGRsZSclMjU+JTIzMTI5MzY1JTNDL3RleHQlM0UlM0Mvc3ZnPiIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <style>
        /* ===== Native App Feel ===== */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            box-sizing: border-box;
        }
        
        html, body {
            overscroll-behavior: none;
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        /* ===== Amazing Animations ===== */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(-3deg); }
            50% { transform: translateY(-20px) rotate(3deg); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-8deg); }
            25% { transform: rotate(8deg); }
            50% { transform: rotate(-8deg); }
            75% { transform: rotate(8deg); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); transform: scale(1); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); transform: scale(1.05); }
        }
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0.5; }
        }
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(100px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slide-down {
            from { opacity: 0; transform: translateY(-100px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(20deg); }
            75% { transform: rotate(-20deg); }
        }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
        @keyframes meteor {
            0% { transform: translateX(0) translateY(0); opacity: 1; }
            70% { opacity: 1; }
            100% { transform: translateX(-300px) translateY(300px); opacity: 0; }
        }
        @keyframes bubble-rise {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
        @keyframes star-twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        @keyframes rocket-fly {
            0% { transform: translateY(0) rotate(-45deg); }
            50% { transform: translateY(-50px) rotate(-45deg); }
            100% { transform: translateY(0) rotate(-45deg); }
        }
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }
        @keyframes progress-fill {
            from { width: 0%; }
        }
        @keyframes card-flip {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(180deg); }
        }
        @keyframes happy-bounce {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-10px) rotate(-5deg) scale(1.1); }
            50% { transform: translateY(-20px) rotate(0deg) scale(1.2); }
            75% { transform: translateY(-10px) rotate(5deg) scale(1.1); }
        }
        @keyframes sad-shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            20% { transform: translateX(-5px) rotate(-5deg); }
            40% { transform: translateX(5px) rotate(5deg); }
            60% { transform: translateX(-5px) rotate(-5deg); }
            80% { transform: translateX(5px) rotate(5deg); }
        }
        @keyframes thinking {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }
        @keyframes water-flow {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        @keyframes flame-flicker {
            0%, 100% { transform: scale(1) rotate(-2deg); opacity: 1; }
            25% { transform: scale(1.1) rotate(2deg); opacity: 0.8; }
            50% { transform: scale(0.9) rotate(-1deg); opacity: 1; }
            75% { transform: scale(1.05) rotate(1deg); opacity: 0.9; }
        }
        @keyframes orbit {
            from { transform: rotate(0deg) translateX(50px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(50px) rotate(-360deg); }
        }
        @keyframes ripple {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        @keyframes door-open {
            0% { transform: rotateY(0deg); transform-origin: left; }
            100% { transform: rotateY(-110deg); transform-origin: left; }
        }
        @keyframes slide-in-left {
            from { opacity: 0; transform: translateX(-100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes zoom-in {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes letter-reveal {
            0% { opacity: 0; transform: translateY(20px) rotateX(90deg); }
            100% { opacity: 1; transform: translateY(0) rotateX(0deg); }
        }

        /* Animation Classes */
        .float { animation: float 3s ease-in-out infinite; }
        .bounce { animation: bounce 1s ease-in-out infinite; }
        .wiggle { animation: wiggle 0.5s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .pop-in { animation: pop-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .slide-up { animation: slide-up 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .slide-down { animation: slide-down 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .zoom-in { animation: zoom-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .happy { animation: happy-bounce 0.8s ease; }
        .shake { animation: shake 0.5s ease; }
        .thinking { animation: thinking 1s ease-in-out infinite; }
        .heartbeat { animation: heartbeat 1.5s ease-in-out infinite; }
        .spin-slow { animation: spin-slow 10s linear infinite; }
        .wave { animation: wave 1s ease-in-out infinite; }
        .rocket { animation: rocket-fly 1s ease-in-out infinite; }

        /* ===== Playful Backgrounds ===== */
        .bg-magic {
            background: linear-gradient(-45deg, #ff9a9e, #fecfef, #fecfef, #a18cd1, #fbc2eb, #a6c1ee);
            background-size: 400% 400%;
            animation: rainbow 15s ease infinite;
        }
        .bg-sunshine {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 50%, #ffecd2 100%);
            background-size: 200% 200%;
            animation: rainbow 10s ease infinite;
        }
        .bg-ocean {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: rainbow 12s ease infinite;
        }
        .bg-forest {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 50%, #56ab2f 100%);
            background-size: 200% 200%;
            animation: rainbow 14s ease infinite;
        }
        .bg-candy {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 50%, #a18cd1 75%, #fbc2eb 100%);
            background-size: 400% 400%;
            animation: rainbow 20s ease infinite;
        }
        .bg-space {
            background: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #2d1b4e 100%);
        }

        /* ===== Glassmorphism ===== */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== 3D Card Effect ===== */
        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .card-3d:hover {
            transform: rotateY(10deg) rotateX(5deg) scale(1.05);
        }

        /* ===== Game Cards ===== */
        .game-card {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        .game-card:hover::before {
            left: 100%;
        }
        .game-card:active {
            transform: scale(0.95);
        }

        /* ===== Confetti ===== */
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            top: -20px;
            animation: confetti-fall linear forwards;
            pointer-events: none;
            z-index: 9999;
        }

        /* ===== Stars Background ===== */
        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .star {
            position: absolute;
            font-size: 20px;
            animation: star-twinkle 2s ease-in-out infinite;
        }

        /* ===== Bubbles Background ===== */
        .bubbles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .bubble-bg {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
            animation: bubble-rise linear forwards;
        }

        /* ===== Custom Scrollbar ===== */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6366f1, #a855f7);
            border-radius: 10px;
        }

        /* ===== Progress Bars ===== */
        .progress-shine {
            position: relative;
            overflow: hidden;
        }
        .progress-shine::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            100% { left: 100%; }
        }

        /* ===== Tea Party Styles ===== */
        .tea-table {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: linear-gradient(145deg, #8B4513, #A0522D, #CD853F);
            position: relative;
            margin: 0 auto;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.4),
                inset 0 -10px 30px rgba(0,0,0,0.3),
                inset 0 10px 20px rgba(255,255,255,0.2);
            border: 10px solid #654321;
        }
        .tablecloth {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 50%;
            background: repeating-conic-gradient(
                from 0deg,
                #FFB6C1 0deg 30deg,
                #FFC0CB 30deg 60deg
            );
            opacity: 0.9;
        }
        .teapot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 70px;
            z-index: 10;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }
        .chair {
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                inset 0 2px 10px rgba(255,255,255,0.3);
            z-index: 5;
        }
        .chair:hover {
            transform: scale(1.2);
        }
        .chair:active {
            transform: scale(1.1);
        }
        .chair-top-left { top: -20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #FFD700, #FFA500); }
        .chair-top-right { top: 50%; right: -30px; transform: translateY(-50%); background: linear-gradient(135deg, #87CEEB, #4169E1); }
        .chair-bottom { bottom: -20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #FF69B4, #FF1493); }
        .chair.order-active {
            animation: wiggle 0.5s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }
        .chair.served {
            animation: happy 1s ease;
        }
        .order-bubble {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: bounce 2s ease-in-out infinite;
        }

        /* ===== Potty Training Styles ===== */
        .potty-avatar {
            width: 120px;
            height: 140px;
            margin: 0 auto;
            position: relative;
        }
        .avatar-head {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FFE4C4, #FFDAB9);
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
            border: 4px solid #DEB887;
            transition: all 0.5s;
        }
        .avatar-head.needs-potty {
            animation: wiggle 0.3s ease-in-out infinite;
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        .avatar-head.happy {
            animation: happy 0.8s ease;
            background: linear-gradient(135deg, #90EE90, #32CD32);
        }
        .avatar-eyes {
            position: absolute;
            top: 25px;
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
        }
        .eye-left { left: 18px; }
        .eye-right { right: 18px; }
        .avatar-mouth {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 12px;
            background: #8B4513;
            border-radius: 0 0 12px 12px;
        }
        .avatar-body {
            width: 60px;
            height: 50px;
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            margin: -5px auto 0;
            border-radius: 10px 10px 20px 20px;
        }
        .potty-dance {
            animation: wiggle 0.5s ease-in-out infinite;
        }

        /* ===== Toilet Visual ===== */
        .toilet-visual {
            width: 160px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }
        .toilet-tank {
            width: 120px;
            height: 60px;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            border-radius: 10px;
            margin: 0 auto;
            border: 3px solid #ccc;
            position: relative;
        }
        .toilet-handle {
            width: 20px;
            height: 10px;
            background: silver;
            border-radius: 5px;
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .toilet-bowl {
            width: 100px;
            height: 80px;
            background: linear-gradient(180deg, #fff, #f0f0f0);
            border: 4px solid #ccc;
            border-radius: 0 0 50px 50px;
            margin: 5px auto 0;
            position: relative;
            overflow: hidden;
        }
        .toilet-water {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, #4FC3F7, #0288D1);
            transition: all 0.5s;
        }
        .toilet-water.flushing {
            animation: water-flow 1s linear infinite;
            background: linear-gradient(180deg, #81D4FA, #29B6F6, #4FC3F7);
        }
        .flush-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .water-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #4FC3F7;
            border-radius: 50%;
            animation: bubble-rise 1s ease-out forwards;
        }

        /* ===== Sink Visual ===== */
        .sink-visual {
            width: 150px;
            margin: 0 auto;
            position: relative;
        }
        .sink-bowl {
            width: 120px;
            height: 60px;
            background: linear-gradient(180deg, #f8f8f8, #e8e8e8);
            border: 4px solid #ccc;
            border-radius: 5px 5px 30px 30px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        .sink-water {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 0;
            background: linear-gradient(180deg, rgba(79, 195, 247, 0.8), rgba(2, 136, 209, 0.9));
            border-radius: 0 0 20px 20px;
            transition: height 0.3s;
        }
        .sink-water.running {
            height: 70%;
        }
        .water-stream {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 0;
            background: linear-gradient(180deg, #4FC3F7, #0288D1);
            border-radius: 4px;
            transition: height 0.3s;
        }
        .water-stream.flowing {
            height: 30px;
            animation: water-flow 0.5s linear infinite;
        }
        .faucet {
            width: 25px;
            height: 40px;
            background: linear-gradient(180deg, #e0e0e0, #b0b0b0);
            margin: -30px auto 0;
            border-radius: 5px 5px 0 0;
            position: relative;
        }
        .soap-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .soap-bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4));
            border: 1px solid rgba(255,255,255,0.6);
            animation: bubble-rise 2s ease-out forwards;
        }

        /* ===== Tracing Canvas ===== */
        .tracing-canvas {
            border: 4px solid #6366f1;
            border-radius: 20px;
            background: white;
            cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><circle cx="12" cy="12" r="8" fill="%236366f1"/></svg>') 12 12, crosshair;
            touch-action: none;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);
        }

        /* ===== Shape Matching ===== */
        .shape-card {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .shape-card:hover {
            transform: scale(1.15) rotate(5deg);
        }
        .shape-card:active {
            transform: scale(1.05);
        }
        .shape-card.matched {
            animation: happy 0.6s ease;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.8);
        }

        /* ===== Number Cards ===== */
        .number-card {
            width: 80px;
            height: 110px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        .number-card:hover {
            transform: translateY(-10px) rotateY(10deg);
        }
        .number-card:active {
            transform: scale(0.95);
        }

        /* ===== Letter Cards ===== */
        .letter-card {
            width: 70px;
            height: 90px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4);
        }
        .letter-card:hover {
            transform: translateY(-10px) rotateX(10deg);
        }

        /* ===== Achievement Badge ===== */
        .achievement-badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            box-shadow: 
                0 10px 30px rgba(255, 215, 0, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.5);
            position: relative;
        }
        .achievement-badge.locked {
            background: linear-gradient(135deg, #ccc, #999);
            filter: grayscale(1);
        }
        .achievement-badge.new::after {
            content: 'NEW';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }

        /* ===== Streak Fire ===== */
        .streak-fire {
            display: inline-block;
            font-size: 30px;
            animation: flame-flicker 0.5s ease-in-out infinite;
        }

        /* ===== Modal Styles ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 30px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            animation: zoom-in 0.3s ease;
        }

        /* ===== Bottom Navigation ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.1);
            padding: 10px 20px;
            padding-bottom: env(safe-area-inset-bottom, 10px);
            z-index: 100;
            display: flex;
            justify-content: space-around;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            border-radius: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .nav-item.active {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        /* ===== Input Styles ===== */
        .input-field {
            width: 100%;
            padding: 15px 20px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }

        /* ===== Button Styles ===== */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.5);
        }
        .btn-primary:active {
            transform: translateY(0);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            color: #333;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* ===== Progress Circle ===== */
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: conic-gradient(
                from 0deg,
                #6366f1 0deg,
                #a855f7 180deg,
                #e0e0e0 180deg,
                #e0e0e0 360deg
            );
        }
        .progress-circle::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
        }
        .progress-circle-value {
            position: relative;
            font-size: 30px;
            font-weight: bold;
            color: #6366f1;
        }

        /* ===== Safe Area Padding ===== */
        .safe-top {
            padding-top: max(env(safe-area-inset-top), 20px);
        }
        .safe-bottom {
            padding-bottom: max(env(safe-area-inset-bottom), 20px);
        }

        /* ===== Hide Scrollbar ===== */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* ===== Drag and Drop ===== */
        .draggable {
            cursor: grab;
            transition: transform 0.2s;
        }
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        .drop-zone {
            transition: all 0.3s;
            border: 3px dashed #ccc;
        }
        .drop-zone.drag-over {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.05);
        }

        /* ===== Flip Card ===== */
        .flip-card {
            perspective: 1000px;
            width: 100px;
            height: 140px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
        }
        .flip-card-front {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .flip-card-back {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            transform: rotateY(180deg);
        }

        /* ===== Word Building ===== */
        .letter-tile {
            width: 50px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        .letter-tile:hover {
            transform: translateY(-5px);
        }
        .letter-tile.used {
            opacity: 0.3;
            pointer-events: none;
        }
        .letter-slot {
            width: 50px;
            height: 60px;
            border: 3px dashed #ccc;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: #6366f1;
            margin: 5px;
            background: rgba(255,255,255,0.5);
        }
        .letter-slot.filled {
            border-style: solid;
            border-color: #6366f1;
            background: white;
        }

        /* ===== Math Game ===== */
        .math-fruit {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        .math-fruit:hover {
            transform: scale(1.1);
        }
        .math-fruit:active {
            transform: scale(0.95);
        }
        .math-basket {
            width: 150px;
            height: 100px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border-radius: 10px 10px 50px 50px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 20px;
            box-shadow: inset 0 -10px 30px rgba(0,0,0,0.3);
        }

        /* ===== Color Game ===== */
        .color-bubble {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .color-bubble:hover {
            transform: scale(1.2);
        }

        /* ===== Puzzle Game ===== */
        .puzzle-piece {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .puzzle-piece:hover {
            transform: scale(1.1);
        }
        .puzzle-piece.selected {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.8);
            transform: scale(1.15);
        }
        .puzzle-slot {
            width: 80px;
            height: 80px;
            border: 3px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.3);
        }
        .puzzle-slot.filled {
            border-style: solid;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
        }

        /* ===== Sound Wave Animation ===== */
        .sound-wave {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .sound-wave span {
            width: 4px;
            height: 20px;
            background: #6366f1;
            border-radius: 2px;
            animation: wave 0.5s ease-in-out infinite;
        }
        .sound-wave span:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.4s; }

        /* ===== Loading Spinner ===== */
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #6366f1;
            border-radius: 50%;
            animation: spin-slow 1s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-magic safe-top safe-bottom overflow-x-hidden" id="app-body">
    <!-- Stars Background -->
    <div class="stars-bg" id="stars-bg"></div>
    
    <!-- Bubbles Background -->
    <div class="bubbles-container" id="bubbles-container"></div>

    <!-- Main App -->
    <div id="app" class="min-h-screen flex flex-col relative z-10">
        <!-- Header -->
        <header class="glass px-4 py-3 sticky top-0 z-50 safe-top">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <button onclick="app.toggleMenu()" class="text-3xl">üéÆ</button>
                    <div>
                        <h1 class="text-xl font-black bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent">Athena</h1>
                        <p class="text-xs text-gray-600 font-semibold" id="header-subtitle">Learn & Play!</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="glass px-3 py-1.5 rounded-full flex items-center gap-2">
                        <span class="streak-fire">üî•</span>
                        <span class="font-bold text-orange-600" id="streak-display">0</span>
                    </div>
                    <div class="glass px-3 py-1.5 rounded-full flex items-center gap-2">
                        <span class="text-xl">‚≠ê</span>
                        <span class="font-bold text-yellow-600" id="points-display">0</span>
                    </div>
                    <button onclick="app.showProfile()" class="text-3xl">üë§</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="flex-grow container mx-auto px-4 py-6 pb-24 overflow-y-auto hide-scrollbar">
            <!-- Content rendered here -->
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" data-view="home" onclick="app.showView('home')">
                <span class="text-2xl">üè†</span>
                <span class="text-xs font-semibold mt-1">Home</span>
            </div>
            <div class="nav-item" data-view="games" onclick="app.showView('games')">
                <span class="text-2xl">üéÆ</span>
                <span class="text-xs font-semibold mt-1">Games</span>
            </div>
            <div class="nav-item" data-view="progress" onclick="app.showView('progress')">
                <span class="text-2xl">üìä</span>
                <span class="text-xs font-semibold mt-1">Progress</span>
            </div>
            <div class="nav-item" data-view="achievements" onclick="app.showView('achievements')">
                <span class="text-2xl">üèÜ</span>
                <span class="text-xs font-semibold mt-1">Badges</span>
            </div>
        </nav>
    </div>

    <!-- ===== Templates ===== -->
    
    <!-- Welcome Template -->
    <template id="template-welcome">
        <div class="flex flex-col items-center justify-center min-h-[80vh] text-center px-4">
            <div class="text-8xl mb-6 float">üåü</div>
            <h1 class="text-5xl font-black mb-4 bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 bg-clip-text text-transparent slide-up">
                Welcome to Athena!
            </h1>
            <p class="text-xl text-gray-700 mb-8 font-semibold slide-up" style="animation-delay: 0.2s;">
                Your learning adventure starts here! üöÄ
            </p>
            
            <!-- Age Selection -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 w-full max-w-3xl">
                <div class="game-card bg-gradient-to-br from-yellow-200 to-orange-200 p-6 rounded-3xl shadow-xl border-4 border-yellow-300 slide-up" style="animation-delay: 0.3s;" onclick="app.selectAge('seedling')">
                    <div class="text-5xl mb-3 bounce">üå±</div>
                    <h3 class="font-black text-xl text-yellow-800">Seedlings</h3>
                    <p class="text-yellow-700 font-semibold">Ages 2-6</p>
                    <div class="flex justify-center gap-2 mt-3">
                        <span class="text-2xl">üéà</span>
                        <span class="text-2xl">üé®</span>
                        <span class="text-2xl">üß∏</span>
                    </div>
                </div>
                <div class="game-card bg-gradient-to-br from-blue-200 to-cyan-200 p-6 rounded-3xl shadow-xl border-4 border-blue-300 slide-up" style="animation-delay: 0.4s;" onclick="app.selectAge('explorer')">
                    <div class="text-5xl mb-3 bounce" style="animation-delay: 0.1s;">üöÄ</div>
                    <h3 class="font-black text-xl text-blue-800">Explorers</h3>
                    <p class="text-blue-700 font-semibold">Ages 7-11</p>
                    <div class="flex justify-center gap-2 mt-3">
                        <span class="text-2xl">üèÜ</span>
                        <span class="text-2xl">‚≠ê</span>
                        <span class="text-2xl">üéØ</span>
                    </div>
                </div>
                <div class="game-card bg-gradient-to-br from-purple-200 to-pink-200 p-6 rounded-3xl shadow-xl border-4 border-purple-300 slide-up" style="animation-delay: 0.5s;" onclick="app.selectAge('master')">
                    <div class="text-5xl mb-3 bounce" style="animation-delay: 0.2s;">‚ö°</div>
                    <h3 class="font-black text-xl text-purple-800">Masters</h3>
                    <p class="text-purple-700 font-semibold">Ages 12-17</p>
                    <div class="flex justify-center gap-2 mt-3">
                        <span class="text-2xl">üìä</span>
                        <span class="text-2xl">üî¨</span>
                        <span class="text-2xl">üéì</span>
                    </div>
                </div>
            </div>

            <button onclick="app.selectAge('explorer')" class="btn-primary pulse-glow">
                üéÆ Start Playing! üéâ
            </button>
        </div>
    </template>

    <!-- Home Template -->
    <template id="template-home">
        <div class="slide-up">
            <!-- Welcome Banner -->
            <div class="glass p-6 rounded-3xl mb-6 relative overflow-hidden">
                <div class="absolute top-2 right-2 text-4xl float">üåü</div>
                <h2 class="text-2xl font-black mb-2" id="welcome-title">Welcome back!</h2>
                <p class="text-gray-600 font-semibold" id="welcome-message">Ready to learn something amazing?</p>
                <div class="flex items-center gap-4 mt-4">
                    <div class="flex-1 bg-white/50 rounded-full h-4 overflow-hidden">
                        <div class="progress-shine h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full" id="daily-progress" style="width: 0%"></div>
                    </div>
                    <span class="text-sm font-bold text-indigo-600" id="daily-progress-text">0/10</span>
                </div>
            </div>

            <!-- Daily Challenge -->
            <div class="glass p-6 rounded-3xl mb-6 relative overflow-hidden" id="daily-challenge-card">
                <div class="absolute -top-4 -right-4 text-5xl bounce">üéØ</div>
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-2xl heartbeat">‚ù§Ô∏è</span>
                    <h3 class="text-lg font-bold">Daily Challenge</h3>
                </div>
                <p class="font-semibold mb-4" id="daily-challenge-text">Complete 3 activities today!</p>
                <div class="flex gap-2">
                    <span class="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold" id="challenge-1">1</span>
                    <span class="w-10 h-10 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center font-bold" id="challenge-2">2</span>
                    <span class="w-10 h-10 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center font-bold" id="challenge-3">3</span>
                </div>
            </div>

            <!-- Quick Play -->
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span class="text-2xl wiggle">‚ö°</span> Quick Play
            </h3>
            <div class="grid grid-cols-2 gap-4 mb-6" id="quick-play-games">
                <!-- Games inserted here -->
            </div>

            <!-- Continue Learning -->
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2" id="continue-section-title">
                <span class="text-2xl bounce">üìö</span> Continue Learning
            </h3>
            <div class="space-y-3" id="continue-learning">
                <!-- Continue items inserted here -->
            </div>
        </div>
    </template>

    <!-- Games List Template -->
    <template id="template-games">
        <div class="slide-up">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-2">
                <span class="text-3xl bounce">üéÆ</span> All Games
            </h2>
            
            <div class="grid grid-cols-2 gap-4" id="games-grid">
                <!-- Games inserted here -->
            </div>
        </div>
    </template>

    <!-- Tea Party Game Template -->
    <template id="template-tea-party">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl float">ü´ñ</span> Tea Party
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="tea-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Progress -->
            <div class="glass p-4 rounded-2xl mb-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-bold">Party Progress</span>
                    <span class="font-bold" id="tea-progress-text">0/5</span>
                </div>
                <div class="w-full bg-white/50 rounded-full h-4 overflow-hidden">
                    <div class="progress-shine h-full bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 rounded-full transition-all duration-500" id="tea-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Task Display -->
            <div class="glass p-4 rounded-2xl mb-6 text-center" id="tea-task-display">
                <p class="text-lg font-black" id="tea-task-text">Give Teddy 2 red cookies!</p>
                <div class="text-3xl mt-2 bounce">üéÄ</div>
            </div>

            <!-- Tea Table -->
            <div class="relative mb-6" style="height: 400px;">
                <!-- Decorative elements -->
                <div class="absolute top-0 left-4 text-4xl float" style="animation-delay: 0s;">üå∏</div>
                <div class="absolute top-0 right-4 text-4xl float" style="animation-delay: 1s;">üå∏</div>
                <div class="absolute bottom-4 left-4 text-3xl float" style="animation-delay: 2s;">‚ú®</div>
                <div class="absolute bottom-4 right-4 text-3xl float" style="animation-delay: 3s;">‚ú®</div>

                <!-- Table -->
                <div class="tea-table" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    <div class="tablecloth"></div>
                    <div class="teapot float">ü´ñ</div>
                    
                    <!-- Chair Top (Teddy) -->
                    <div class="chair chair-top-left" id="chair-teddy" onclick="app.teaPartyClickChair('Teddy')">
                        üß∏
                        <div class="order-bubble" id="order-teddy"></div>
                    </div>
                    
                    <!-- Chair Right (Robot) -->
                    <div class="chair chair-top-right" id="chair-robot" onclick="app.teaPartyClickChair('Robot')">
                        ü§ñ
                        <div class="order-bubble" id="order-robot"></div>
                    </div>
                    
                    <!-- Chair Bottom (Doll) -->
                    <div class="chair chair-bottom" id="chair-doll" onclick="app.teaPartyClickChair('Doll')">
                        üë∏
                        <div class="order-bubble" id="order-doll"></div>
                    </div>
                </div>
            </div>

            <!-- Items Tray -->
            <div class="glass p-4 rounded-2xl">
                <p class="text-center font-bold mb-3">üçΩÔ∏è Select items to serve:</p>
                <div class="flex justify-center gap-3 flex-wrap" id="tea-items">
                    <!-- Items inserted here -->
                </div>
            </div>

            <!-- Feedback -->
            <div id="tea-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Tracing Game Template -->
    <template id="template-tracing">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">‚úèÔ∏è</span> Tracing
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="trace-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Mode Selection -->
            <div class="flex gap-2 mb-6 overflow-x-auto hide-scrollbar pb-2">
                <button onclick="app.setTraceMode('number')" class="trace-mode-btn glass px-4 py-2 rounded-full whitespace-nowrap font-semibold" data-mode="number">üî¢ Numbers</button>
                <button onclick="app.setTraceMode('letter')" class="trace-mode-btn glass px-4 py-2 rounded-full whitespace-nowrap font-semibold" data-mode="letter">üî§ Letters</button>
                <button onclick="app.setTraceMode('shape')" class="trace-mode-btn glass px-4 py-2 rounded-full whitespace-nowrap font-semibold" data-mode="shape">üî∑ Shapes</button>
                <button onclick="app.setTraceMode('word')" class="trace-mode-btn glass px-4 py-2 rounded-full whitespace-nowrap font-semibold" data-mode="word">üìù Words</button>
            </div>

            <!-- Trace Target -->
            <div class="text-center mb-4">
                <div class="inline-block relative">
                    <div id="trace-target" class="text-9xl font-black text-indigo-200 select-none" style="font-family: 'Comic Sans MS', cursive;">5</div>
                    <canvas id="trace-canvas" class="tracing-canvas absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" width="300" height="300"></canvas>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex gap-3 justify-center mb-6">
                <button onclick="app.clearCanvas()" class="btn-secondary">üóëÔ∏è Clear</button>
                <button onclick="app.checkTracing()" class="btn-primary">‚úÖ Check</button>
                <button onclick="app.nextTrace()" class="btn-primary">‚û°Ô∏è Next</button>
            </div>

            <!-- Progress -->
            <div class="glass p-4 rounded-2xl text-center">
                <p class="font-semibold">Traced today: <span id="trace-count" class="text-indigo-600 font-bold">0</span></p>
            </div>

            <!-- Feedback -->
            <div id="trace-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Shape Matching Game Template -->
    <template id="template-shapes">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üî∑</span> Shapes
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="shapes-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Instructions -->
            <div class="glass p-4 rounded-2xl mb-6 text-center">
                <p class="font-bold" id="shapes-instruction">Find the Circle! ‚≠ï</p>
            </div>

            <!-- Shapes Grid -->
            <div class="grid grid-cols-3 gap-4 mb-6" id="shapes-grid">
                <!-- Shapes inserted here -->
            </div>

            <!-- Score Display -->
            <div class="glass p-4 rounded-2xl text-center">
                <p class="font-semibold">Score: <span id="shapes-correct" class="text-green-600 font-bold">0</span> / <span id="shapes-total">0</span></p>
            </div>

            <!-- Feedback -->
            <div id="shapes-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Number Match Game Template -->
    <template id="template-numbers">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üî¢</span> Numbers
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="numbers-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Instructions -->
            <div class="glass p-4 rounded-2xl mb-6 text-center">
                <p class="font-bold" id="numbers-instruction">Find the number 5!</p>
            </div>

            <!-- Numbers Grid -->
            <div class="grid grid-cols-3 gap-4 mb-6" id="numbers-grid">
                <!-- Numbers inserted here -->
            </div>

            <!-- Feedback -->
            <div id="numbers-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Letters Game Template -->
    <template id="template-letters">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üî§</span> Letters
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="letters-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Instructions -->
            <div class="glass p-4 rounded-2xl mb-6 text-center">
                <p class="font-bold" id="letters-instruction">Find the letter A!</p>
            </div>

            <!-- Letters Grid -->
            <div class="grid grid-cols-4 gap-3 mb-6" id="letters-grid">
                <!-- Letters inserted here -->
            </div>

            <!-- Feedback -->
            <div id="letters-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Word Builder Game Template -->
    <template id="template-words">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üìù</span> Word Builder
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="words-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Word Display with Image -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <div class="text-6xl mb-4" id="word-image">üçé</div>
                <p class="font-semibold text-gray-600">Spell the word:</p>
            </div>

            <!-- Letter Slots -->
            <div class="flex justify-center mb-6" id="word-slots">
                <!-- Slots inserted here -->
            </div>

            <!-- Available Letters -->
            <div class="flex justify-center flex-wrap gap-2 mb-6" id="word-letters">
                <!-- Letters inserted here -->
            </div>

            <!-- Controls -->
            <div class="flex gap-3 justify-center">
                <button onclick="app.resetWord()" class="btn-secondary">üîÑ Reset</button>
                <button onclick="app.checkWord()" class="btn-primary">‚úÖ Check</button>
            </div>

            <!-- Feedback -->
            <div id="words-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Math Fruits Game Template -->
    <template id="template-math">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üçé</span> Math Fun
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="math-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Problem Display -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <p class="text-3xl font-black" id="math-problem">2 + 3 = ?</p>
            </div>

            <!-- Fruits to Count -->
            <div class="flex justify-center gap-3 flex-wrap mb-6" id="math-fruits">
                <!-- Fruits inserted here -->
            </div>

            <!-- Answer Options -->
            <div class="grid grid-cols-3 gap-4 mb-6" id="math-answers">
                <!-- Answers inserted here -->
            </div>

            <!-- Feedback -->
            <div id="math-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Colors Game Template -->
    <template id="template-colors">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üé®</span> Colors
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="colors-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Instructions -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <p class="font-bold text-lg">Find the <span id="color-target-name" class="font-black text-red-500">RED</span> color!</p>
            </div>

            <!-- Colors Grid -->
            <div class="grid grid-cols-3 gap-4 mb-6" id="colors-grid">
                <!-- Colors inserted here -->
            </div>

            <!-- Feedback -->
            <div id="colors-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Memory Game Template -->
    <template id="template-memory">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üß†</span> Memory
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="memory-moves">0</span> moves
                </div>
            </div>

            <!-- Memory Grid -->
            <div class="grid grid-cols-4 gap-3 mb-6" id="memory-grid">
                <!-- Cards inserted here -->
            </div>

            <!-- Controls -->
            <div class="flex gap-3 justify-center">
                <button onclick="app.restartMemory()" class="btn-secondary">üîÑ Restart</button>
            </div>

            <!-- Feedback -->
            <div id="memory-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Puzzle Game Template -->
    <template id="template-puzzle">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üß©</span> Puzzle
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="puzzle-time">0:00</span>
                </div>
            </div>

            <!-- Target Image -->
            <div class="glass p-4 rounded-2xl mb-4 text-center">
                <p class="font-semibold mb-2">Complete the pattern:</p>
                <div class="text-4xl" id="puzzle-target">üåà‚≠êüéà‚ù§Ô∏èüöÄ</div>
            </div>

            <!-- Pieces -->
            <div class="flex justify-center gap-2 mb-6 flex-wrap" id="puzzle-pieces">
                <!-- Pieces inserted here -->
            </div>

            <!-- Slots -->
            <div class="flex justify-center gap-2 flex-wrap mb-6" id="puzzle-slots">
                <!-- Slots inserted here -->
            </div>

            <!-- Controls -->
            <div class="flex gap-3 justify-center">
                <button onclick="app.resetPuzzle()" class="btn-secondary">üîÑ Reset</button>
            </div>

            <!-- Feedback -->
            <div id="puzzle-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Pattern Game Template -->
    <template id="template-patterns">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üé®</span> Patterns
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="patterns-score">0</span> ‚≠ê
                </div>
            </div>

            <!-- Pattern Display -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <p class="font-semibold mb-4">What comes next?</p>
                <div class="flex justify-center gap-3 flex-wrap" id="pattern-display">
                    <!-- Pattern inserted here -->
                </div>
            </div>

            <!-- Answer Options -->
            <div class="flex justify-center gap-4 mb-6" id="pattern-options">
                <!-- Options inserted here -->
            </div>

            <!-- Feedback -->
            <div id="patterns-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Potty Training Template -->
    <template id="template-potty">
        <div class="slide-up">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="app.exitGame()" class="glass px-4 py-2 rounded-full flex items-center gap-2">
                    <span>‚Üê</span> Back
                </button>
                <h2 class="text-xl font-black flex items-center gap-2">
                    <span class="text-2xl bounce">üöΩ</span> Potty Time
                </h2>
                <div class="glass px-4 py-2 rounded-full">
                    <span id="potty-streak">0</span> üî•
                </div>
            </div>

            <!-- Step 1: Recognition -->
            <div id="potty-step-1" class="glass p-6 rounded-2xl mb-6 text-center">
                <div class="potty-avatar mb-4" id="potty-avatar">
                    <div class="avatar-head needs-potty">
                        <div class="avatar-eyes eye-left"></div>
                        <div class="avatar-eyes eye-right"></div>
                        <div class="avatar-mouth"></div>
                    </div>
                    <div class="avatar-body"></div>
                </div>
                <p class="text-xl font-black mb-4 wiggle">I need to go potty! üöΩ</p>
                <button onclick="app.pottyGo()" class="btn-primary pulse-glow">üëç Let's Go!</button>
            </div>

            <!-- Step 2: Toilet -->
            <div id="potty-step-2" class="glass p-6 rounded-2xl mb-6 text-center hidden">
                <p class="font-semibold mb-4">Sit on the potty:</p>
                <div class="toilet-visual mb-4">
                    <div class="toilet-tank">
                        <div class="toilet-handle" onclick="app.pottyFlush()"></div>
                    </div>
                    <div class="toilet-bowl">
                        <div class="toilet-water" id="toilet-water"></div>
                        <div class="flush-particles" id="flush-particles"></div>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-4">Click the handle to flush when done!</p>
                <button onclick="app.pottyNext()" class="btn-primary">‚úÖ Done!</button>
            </div>

            <!-- Step 3: Wipe -->
            <div id="potty-step-3" class="glass p-6 rounded-2xl mb-6 text-center hidden">
                <div class="text-6xl mb-4 bounce">üßª</div>
                <p class="font-semibold mb-4">Wipe yourself clean:</p>
                <div class="flex justify-center gap-4 mb-4">
                    <button onclick="app.pottyWipe()" class="text-5xl hover:scale-110 transition">üßª</button>
                </div>
                <p class="text-sm text-gray-600">Tap to wipe!</p>
                <p class="text-sm text-indigo-600 font-bold mt-2">Wipes: <span id="potty-wipes">0</span>/3</p>
                <button onclick="app.pottyNext()" class="btn-primary mt-4">‚úÖ Done!</button>
            </div>

            <!-- Step 4: Wash Hands -->
            <div id="potty-step-4" class="glass p-6 rounded-2xl mb-6 text-center hidden">
                <div class="sink-visual mb-4">
                    <div class="faucet"></div>
                    <div class="water-stream" id="water-stream"></div>
                    <div class="sink-bowl">
                        <div class="sink-water" id="sink-water"></div>
                        <div class="soap-bubbles" id="soap-bubbles"></div>
                    </div>
                </div>
                <p class="font-semibold mb-4">Wash your hands with soap!</p>
                <div class="flex justify-center gap-4 mb-4">
                    <button onclick="app.pottyWash()" class="text-5xl hover:scale-110 transition">üß¥</button>
                    <button onclick="app.pottyWater()" class="text-5xl hover:scale-110 transition">üíß</button>
                </div>
                <p class="text-sm text-gray-600">Use soap and water for 20 seconds!</p>
                <p class="text-sm text-indigo-600 font-bold mt-2">Time: <span id="potty-timer">0</span>s</p>
                <button onclick="app.pottyComplete()" class="btn-primary mt-4">üéâ All Done!</button>
            </div>

            <!-- Success -->
            <div id="potty-success" class="glass p-6 rounded-2xl mb-6 text-center hidden">
                <div class="text-6xl mb-4 happy">üéâ</div>
                <h3 class="text-2xl font-black mb-4">Great Job!</h3>
                <p class="text-gray-600 mb-4">You remembered all the steps!</p>
                <div class="flex justify-center gap-2 mb-4">
                    <span class="text-4xl bounce">‚≠ê</span>
                    <span class="text-4xl bounce" style="animation-delay: 0.1s;">‚≠ê</span>
                    <span class="text-4xl bounce" style="animation-delay: 0.2s;">‚≠ê</span>
                </div>
                <button onclick="app.exitGame()" class="btn-primary">üè† Home</button>
            </div>

            <!-- Feedback -->
            <div id="potty-feedback" class="mt-4 p-4 rounded-2xl text-center hidden"></div>
        </div>
    </template>

    <!-- Progress Template -->
    <template id="template-progress">
        <div class="slide-up">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-2">
                <span class="text-3xl bounce">üìä</span> Your Progress
            </h2>

            <!-- Stats Overview -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="glass p-4 rounded-2xl text-center">
                    <div class="text-4xl mb-2 float">‚≠ê</div>
                    <div class="text-3xl font-black text-yellow-600" id="progress-points">0</div>
                    <p class="text-gray-600 font-semibold">Total Points</p>
                </div>
                <div class="glass p-4 rounded-2xl text-center">
                    <div class="text-4xl mb-2 bounce">üî•</div>
                    <div class="text-3xl font-black text-orange-600" id="progress-streak">0</div>
                    <p class="text-gray-600 font-semibold">Day Streak</p>
                </div>
                <div class="glass p-4 rounded-2xl text-center">
                    <div class="text-4xl mb-2 wiggle">üß†</div>
                    <div class="text-3xl font-black text-purple-600" id="progress-connections">0</div>
                    <p class="text-gray-600 font-semibold">Brain Connections</p>
                </div>
                <div class="glass p-4 rounded-2xl text-center">
                    <div class="text-4xl mb-2 heartbeat">üéÆ</div>
                    <div class="text-3xl font-black text-blue-600" id="progress-games">0</div>
                    <p class="text-gray-600 font-semibold">Games Played</p>
                </div>
            </div>

            <!-- Weekly Activity -->
            <div class="glass p-4 rounded-2xl mb-6">
                <h3 class="font-bold mb-4">This Week</h3>
                <div class="flex justify-between" id="weekly-activity">
                    <!-- Days inserted here -->
                </div>
            </div>

            <!-- Learning Areas -->
            <div class="glass p-4 rounded-2xl">
                <h3 class="font-bold mb-4">Learning Areas</h3>
                <div class="space-y-3" id="learning-areas">
                    <!-- Areas inserted here -->
                </div>
            </div>
        </div>
    </template>

    <!-- Achievements Template -->
    <template id="template-achievements">
        <div class="slide-up">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-2">
                <span class="text-3xl bounce">üèÜ</span> Achievements
            </h2>

            <!-- Badges Grid -->
            <div class="grid grid-cols-3 gap-4" id="badges-grid">
                <!-- Badges inserted here -->
            </div>

            <!-- Recent Achievements -->
            <div class="glass p-4 rounded-2xl mt-6">
                <h3 class="font-bold mb-4">Recently Earned</h3>
                <div class="space-y-3" id="recent-achievements">
                    <!-- Recent inserted here -->
                </div>
            </div>
        </div>
    </template>

    <!-- Profile Template -->
    <template id="template-profile">
        <div class="slide-up">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-2">
                <span class="text-3xl bounce">üë§</span> Profile
            </h2>

            <!-- Avatar -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <div class="text-8xl mb-4 float">üßí</div>
                <h3 class="text-2xl font-black" id="profile-name">Explorer</h3>
                <p class="text-gray-600" id="profile-age">Age Group: Explorers</p>
                <div class="flex justify-center gap-2 mt-4">
                    <span class="px-4 py-1 bg-indigo-100 text-indigo-700 rounded-full font-semibold">Level <span id="profile-level">1</span></span>
                </div>
            </div>

            <!-- Stats -->
            <div class="glass p-4 rounded-2xl mb-6">
                <div class="flex justify-between items-center mb-3">
                    <span class="font-semibold">Experience</span>
                    <span class="font-bold text-indigo-600"><span id="profile-exp">0</span> / <span id="profile-exp-max">100</span></span>
                </div>
                <div class="w-full bg-white/50 rounded-full h-4 overflow-hidden">
                    <div class="progress-shine h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full" id="profile-exp-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Settings -->
            <div class="glass p-4 rounded-2xl space-y-4">
                <h3 class="font-bold">Settings</h3>
                <div class="flex justify-between items-center">
                    <span>Sound Effects</span>
                    <button onclick="app.toggleSound()" class="w-14 h-8 rounded-full bg-indigo-500 relative" id="sound-toggle">
                        <span class="absolute w-6 h-6 bg-white rounded-full top-1 left-7 transition-all"></span>
                    </button>
                </div>
                <div class="flex justify-between items-center">
                    <span>Vibrations</span>
                    <button onclick="app.toggleVibration()" class="w-14 h-8 rounded-full bg-indigo-500 relative" id="vibration-toggle">
                        <span class="absolute w-6 h-6 bg-white rounded-full top-1 left-7 transition-all"></span>
                    </button>
                </div>
            </div>

            <!-- Reset Button -->
            <button onclick="app.resetProgress()" class="w-full mt-6 p-4 rounded-2xl bg-red-100 text-red-600 font-bold">
                üîÑ Reset Progress
            </button>
        </div>
    </template>

    <!-- Success Modal Template -->
    <template id="template-success-modal">
        <div class="modal-overlay" id="success-modal-overlay">
            <div class="modal-content">
                <div class="text-7xl mb-4 bounce" id="modal-icon">üéâ</div>
                <h3 class="text-2xl font-black mb-2" id="modal-title">Amazing!</h3>
                <p class="text-gray-600 mb-4" id="modal-message">You did great!</p>
                <div class="bg-yellow-100 p-4 rounded-2xl mb-4" id="modal-points">
                    <span class="text-2xl">‚≠ê</span>
                    <span class="text-2xl font-black text-yellow-700" id="modal-points-value">+10</span>
                </div>
                <button onclick="app.closeModal()" class="btn-primary">Continue! üöÄ</button>
            </div>
        </div>
    </template>

    <!-- Sound Effects (Audio) -->
    <audio id="sfx-success" preload="auto"></audio>
    <audio id="sfx-error" preload="auto"></audio>
    <audio id="sfx-click" preload="auto"></audio>
    <audio id="sfx-pop" preload="auto"></audio>
    <audio id="sfx-win" preload="auto"></audio>
    <audio id="sfx-flush" preload="auto"></audio>
    <audio id="sfx-water" preload="auto"></audio>

    <script>
        // ===== Athena PWA - Main Application =====
        const app = {
            // State
            state: {
                view: 'welcome',
                ageGroup: null,
                soundEnabled: true,
                vibrationEnabled: true,
                user: {
                    name: 'Explorer',
                    level: 1,
                    exp: 0,
                    points: 0,
                    streak: 0,
                    brainConnections: 0,
                    gamesPlayed: 0,
                    lastPlay: null
                },
                progress: {
                    dailyChallenges: 0,
                    weeklyActivity: [0, 0, 0, 0, 0, 0, 0],
                    learningAreas: {
                        math: 0,
                        reading: 0,
                        science: 0,
                        social: 0
                    }
                },
                achievements: [],
                currentGame: null,
                gameData: {}
            },

            // Game Definitions
            games: {
                seedling: [
                    { id: 'tea-party', name: 'Tea Party', icon: 'ü´ñ', color: 'from-pink-400 to-rose-400', desc: 'Math & Social Skills' },
                    { id: 'tracing', name: 'Tracing', icon: '‚úèÔ∏è', color: 'from-blue-400 to-cyan-400', desc: 'Writing Practice' },
                    { id: 'shapes', name: 'Shapes', icon: 'üî∑', color: 'from-purple-400 to-violet-400', desc: 'Learn Geometry' },
                    { id: 'numbers', name: 'Numbers', icon: 'üî¢', color: 'from-green-400 to-emerald-400', desc: 'Count & Match' },
                    { id: 'letters', name: 'Letters', icon: 'üî§', color: 'from-yellow-400 to-orange-400', desc: 'ABC Fun' },
                    { id: 'colors', name: 'Colors', icon: 'üé®', color: 'from-red-400 to-pink-400', desc: 'Color Match' },
                    { id: 'potty', name: 'Potty Time', icon: 'üöΩ', color: 'from-teal-400 to-cyan-400', desc: 'Life Skills' },
                    { id: 'memory', name: 'Memory', icon: 'üß†', color: 'from-indigo-400 to-purple-400', desc: 'Match Cards' }
                ],
                explorer: [
                    { id: 'tea-party', name: 'Tea Party', icon: 'ü´ñ', color: 'from-pink-400 to-rose-400', desc: 'Advanced Math' },
                    { id: 'tracing', name: 'Tracing', icon: '‚úèÔ∏è', color: 'from-blue-400 to-cyan-400', desc: 'Writing Practice' },
                    { id: 'words', name: 'Word Builder', icon: 'üìù', color: 'from-emerald-400 to-green-400', desc: 'Spelling Fun' },
                    { id: 'math', name: 'Math Fun', icon: 'üçé', color: 'from-orange-400 to-red-400', desc: 'Add & Subtract' },
                    { id: 'patterns', name: 'Patterns', icon: 'üé®', color: 'from-purple-400 to-pink-400', desc: 'Logic Puzzles' },
                    { id: 'puzzle', name: 'Puzzle', icon: 'üß©', color: 'from-cyan-400 to-blue-400', desc: 'Complete Patterns' },
                    { id: 'memory', name: 'Memory', icon: 'üß†', color: 'from-indigo-400 to-violet-400', desc: 'Brain Training' }
                ],
                master: [
                    { id: 'words', name: 'Word Builder', icon: 'üìù', color: 'from-emerald-400 to-green-400', desc: 'Advanced Spelling' },
                    { id: 'math', name: 'Math Fun', icon: 'üçé', color: 'from-orange-400 to-red-400', desc: 'Challenge Mode' },
                    { id: 'patterns', name: 'Patterns', icon: 'üé®', color: 'from-purple-400 to-pink-400', desc: 'Complex Logic' },
                    { id: 'puzzle', name: 'Puzzle', icon: 'üß©', color: 'from-cyan-400 to-blue-400', desc: 'Advanced Puzzles' },
                    { id: 'memory', name: 'Memory', icon: 'üß†', color: 'from-indigo-400 to-violet-400', desc: 'Memory Master' }
                ]
            },

            // Badges
            badges: [
                { id: 'first-game', name: 'First Steps', icon: 'üë∂', desc: 'Play your first game', requirement: 1 },
                { id: 'streak-3', name: 'On Fire', icon: 'üî•', desc: '3 day streak', requirement: 3 },
                { id: 'streak-7', name: 'Week Warrior', icon: '‚ö°', desc: '7 day streak', requirement: 7 },
                { id: 'points-100', name: 'Star Collector', icon: '‚≠ê', desc: 'Earn 100 points', requirement: 100 },
                { id: 'points-500', name: 'Super Star', icon: 'üåü', desc: 'Earn 500 points', requirement: 500 },
                { id: 'games-10', name: 'Game Master', icon: 'üéÆ', desc: 'Play 10 games', requirement: 10 },
                { id: 'math-10', name: 'Math Wizard', icon: 'üßÆ', desc: 'Complete 10 math games', requirement: 10 },
                { id: 'words-10', name: 'Word Smith', icon: 'üìö', desc: 'Complete 10 word games', requirement: 10 }
            ],

            // Initialize
            init() {
                this.loadState();
                this.setupBackground();
                this.registerServiceWorker();
                this.render();
                this.updateStreak();
                this.setupAudio();
            },

            // Setup Audio with Generated Sounds
            setupAudio() {
                // Create simple beep sounds using Web Audio API
                this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            },

            playSound(type) {
                if (!this.state.soundEnabled) return;
                
                try {
                    const oscillator = this.audioCtx.createOscillator();
                    const gainNode = this.audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioCtx.destination);
                    
                    if (type === 'success') {
                        oscillator.frequency.setValueAtTime(523.25, this.audioCtx.currentTime);
                        oscillator.frequency.setValueAtTime(659.25, this.audioCtx.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(783.99, this.audioCtx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.3, this.audioCtx.currentTime);
                        gainNode.gain.exponentialDecayTo = 0.01;
                        oscillator.start(this.audioCtx.currentTime);
                        oscillator.stop(this.audioCtx.currentTime + 0.3);
                    } else if (type === 'error') {
                        oscillator.frequency.setValueAtTime(200, this.audioCtx.currentTime);
                        gainNode.gain.setValueAtTime(0.3, this.audioCtx.currentTime);
                        oscillator.start(this.audioCtx.currentTime);
                        oscillator.stop(this.audioCtx.currentTime + 0.2);
                    } else if (type === 'click') {
                        oscillator.frequency.setValueAtTime(800, this.audioCtx.currentTime);
                        gainNode.gain.setValueAtTime(0.1, this.audioCtx.currentTime);
                        oscillator.start(this.audioCtx.currentTime);
                        oscillator.stop(this.audioCtx.currentTime + 0.05);
                    } else if (type === 'win') {
                        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                            const osc = this.audioCtx.createOscillator();
                            const gain = this.audioCtx.createGain();
                            osc.connect(gain);
                            gain.connect(this.audioCtx.destination);
                            osc.frequency.setValueAtTime(freq, this.audioCtx.currentTime + i * 0.15);
                            gain.gain.setValueAtTime(0.2, this.audioCtx.currentTime + i * 0.15);
                            osc.start(this.audioCtx.currentTime + i * 0.15);
                            osc.stop(this.audioCtx.currentTime + i * 0.15 + 0.15);
                        });
                    } else if (type === 'flush') {
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(150, this.audioCtx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(50, this.audioCtx.currentTime + 1);
                        gainNode.gain.setValueAtTime(0.2, this.audioCtx.currentTime);
                        oscillator.start(this.audioCtx.currentTime);
                        oscillator.stop(this.audioCtx.currentTime + 1);
                    } else if (type === 'water') {
                        oscillator.type = 'sine';
                        for (let i = 0; i < 10; i++) {
                            oscillator.frequency.setValueAtTime(400 + Math.random() * 200, this.audioCtx.currentTime + i * 0.1);
                        }
                        gainNode.gain.setValueAtTime(0.1, this.audioCtx.currentTime);
                        oscillator.start(this.audioCtx.currentTime);
                        oscillator.stop(this.audioCtx.currentTime + 1);
                    }
                } catch (e) {
                    console.log('Audio error:', e);
                }
            },

            // Vibration feedback
            vibrate(pattern = 50) {
                if (this.state.vibrationEnabled && navigator.vibrate) {
                    navigator.vibrate(pattern);
                }
            },

            // Setup Background Effects
            setupBackground() {
                // Create stars
                const starsBg = document.getElementById('stars-bg');
                if (starsBg) {
                    for (let i = 0; i < 20; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.textContent = Math.random() > 0.5 ? '‚≠ê' : '‚ú®';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.animationDelay = Math.random() * 2 + 's';
                        star.style.fontSize = (Math.random() * 20 + 10) + 'px';
                        starsBg.appendChild(star);
                    }
                }

                // Create bubbles
                const bubblesContainer = document.getElementById('bubbles-container');
                if (bubblesContainer) {
                    const createBubble = () => {
                        const bubble = document.createElement('div');
                        bubble.className = 'bubble-bg';
                        const size = Math.random() * 60 + 20;
                        bubble.style.width = size + 'px';
                        bubble.style.height = size + 'px';
                        bubble.style.left = Math.random() * 100 + '%';
                        bubble.style.animationDuration = (Math.random() * 10 + 10) + 's';
                        bubblesContainer.appendChild(bubble);
                        setTimeout(() => bubble.remove(), 20000);
                    };
                    createBubble();
                    setInterval(createBubble, 3000);
                }
            },

            // Register Service Worker
            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    const swCode = `
                        self.addEventListener('install', e => {
                            e.waitUntil(self.skipWaiting());
                        });
                        self.addEventListener('activate', e => {
                            e.waitUntil(self.clients.claim());
                        });
                        self.addEventListener('fetch', e => {
                            e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
                        });
                    `;
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
                }
            },

            // State Management
            saveState() {
                localStorage.setItem('athena-state', JSON.stringify(this.state));
            },

            loadState() {
                const saved = localStorage.getItem('athena-state');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        this.state = { ...this.state, ...parsed };
                    } catch (e) {}
                }
            },

            // Update Streak
            updateStreak() {
                const today = new Date().toDateString();
                const lastPlay = this.state.user.lastPlay;
                
                if (lastPlay) {
                    const lastDate = new Date(lastPlay);
                    const daysDiff = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff === 1) {
                        this.state.user.streak++;
                    } else if (daysDiff > 1) {
                        this.state.user.streak = 1;
                    }
                } else {
                    this.state.user.streak = 1;
                }
                
                this.state.user.lastPlay = today;
                this.updateDisplays();
                this.saveState();
            },

            // Update Displays
            updateDisplays() {
                const points = document.getElementById('points-display');
                const streak = document.getElementById('streak-display');
                
                if (points) points.textContent = this.state.user.points;
                if (streak) streak.textContent = this.state.user.streak;
            },

            // Navigation
            showView(view) {
                this.state.view = view;
                this.render();
                this.updateNavActive();
            },

            updateNavActive() {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.view === this.state.view);
                });
            },

            toggleMenu() {
                this.showView('games');
            },

            showProfile() {
                this.showView('profile');
            },

            // Age Selection
            selectAge(group) {
                this.state.ageGroup = group;
                this.applyTheme(group);
                this.showView('home');
                this.saveState();
                this.showConfetti();
                this.playSound('win');
            },

            applyTheme(group) {
                const body = document.getElementById('app-body');
                body.className = 'min-h-screen safe-top safe-bottom overflow-x-hidden';
                
                if (group === 'seedling') {
                    body.classList.add('bg-sunshine');
                } else if (group === 'explorer') {
                    body.classList.add('bg-ocean');
                } else if (group === 'master') {
                    body.classList.add('bg-space');
                } else {
                    body.classList.add('bg-magic');
                }
            },

            // Render
            render() {
                const main = document.getElementById('main-content');
                const template = document.getElementById(`template-${this.state.view}`);
                
                if (template) {
                    main.innerHTML = '';
                    main.appendChild(template.content.cloneNode(true));
                    this.postRender();
                }
            },

            postRender() {
                // View-specific setup
                switch (this.state.view) {
                    case 'home':
                        this.setupHome();
                        break;
                    case 'games':
                        this.setupGamesList();
                        break;
                    case 'progress':
                        this.setupProgress();
                        break;
                    case 'achievements':
                        this.setupAchievements();
                        break;
                    case 'profile':
                        this.setupProfile();
                        break;
                    case 'tea-party':
                        this.initTeaParty();
                        break;
                    case 'tracing':
                        this.initTracing();
                        break;
                    case 'shapes':
                        this.initShapes();
                        break;
                    case 'numbers':
                        this.initNumbers();
                        break;
                    case 'letters':
                        this.initLetters();
                        break;
                    case 'words':
                        this.initWords();
                        break;
                    case 'math':
                        this.initMath();
                        break;
                    case 'colors':
                        this.initColors();
                        break;
                    case 'memory':
                        this.initMemory();
                        break;
                    case 'puzzle':
                        this.initPuzzle();
                        break;
                    case 'patterns':
                        this.initPatterns();
                        break;
                    case 'potty':
                        this.initPotty();
                        break;
                    case 'welcome':
                        this.applyTheme(null);
                        break;
                }
            },

            // Setup Home
            setupHome() {
                const games = this.games[this.state.ageGroup] || this.games.seedling;
                const quickPlay = document.getElementById('quick-play-games');
                const continueLearning = document.getElementById('continue-learning');
                
                if (quickPlay) {
                    quickPlay.innerHTML = games.slice(0, 4).map(game => `
                        <div class="game-card bg-gradient-to-br ${game.color} p-4 rounded-2xl shadow-lg cursor-pointer" onclick="app.startGame('${game.id}')">
                            <div class="text-4xl mb-2 bounce">${game.icon}</div>
                            <h3 class="font-bold text-sm">${game.name}</h3>
                            <p class="text-xs opacity-80">${game.desc}</p>
                        </div>
                    `).join('');
                }

                // Daily progress
                const dailyProgress = document.getElementById('daily-progress');
                const dailyProgressText = document.getElementById('daily-progress-text');
                if (dailyProgress && dailyProgressText) {
                    const completed = Math.min(this.state.progress.dailyChallenges, 10);
                    const percent = (completed / 10) * 100;
                    dailyProgress.style.width = percent + '%';
                    dailyProgressText.textContent = `${completed}/10`;
                }

                // Daily challenge
                for (let i = 1; i <= 3; i++) {
                    const el = document.getElementById(`challenge-${i}`);
                    if (el) {
                        if (i <= this.state.progress.dailyChallenges) {
                            el.className = 'w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold';
                            el.textContent = '‚úì';
                        }
                    }
                }
            },

            // Setup Games List
            setupGamesList() {
                const games = this.games[this.state.ageGroup] || this.games.seedling;
                const grid = document.getElementById('games-grid');
                
                if (grid) {
                    grid.innerHTML = games.map((game, index) => `
                        <div class="game-card bg-gradient-to-br ${game.color} p-5 rounded-3xl shadow-xl slide-up" style="animation-delay: ${index * 0.1}s;" onclick="app.startGame('${game.id}')">
                            <div class="text-5xl mb-3 float">${game.icon}</div>
                            <h3 class="font-black text-lg mb-1">${game.name}</h3>
                            <p class="text-sm opacity-80 font-semibold">${game.desc}</p>
                            <div class="mt-3 flex items-center gap-1">
                                <span class="bg-white/30 px-3 py-1 rounded-full text-xs font-bold">Play ‚ñ∂</span>
                            </div>
                        </div>
                    `).join('');
                }
            },

            // Setup Progress
            setupProgress() {
                document.getElementById('progress-points').textContent = this.state.user.points;
                document.getElementById('progress-streak').textContent = this.state.user.streak;
                document.getElementById('progress-connections').textContent = this.state.user.brainConnections;
                document.getElementById('progress-games').textContent = this.state.user.gamesPlayed;

                // Weekly activity
                const weekly = document.getElementById('weekly-activity');
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                if (weekly) {
                    weekly.innerHTML = days.map((day, i) => {
                        const activity = this.state.progress.weeklyActivity[i];
                        const height = Math.max(20, activity * 20);
                        return `
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-white/50 rounded-t-lg" style="height: ${height}px;">
                                    <div class="w-full bg-gradient-to-t from-indigo-500 to-purple-500 rounded-t-lg" style="height: ${Math.min(100, activity * 20)}%;"></div>
                                </div>
                                <span class="text-xs font-semibold">${day}</span>
                            </div>
                        `;
                    }).join('');
                }

                // Learning areas
                const areas = document.getElementById('learning-areas');
                const areaNames = { math: 'üî¢ Math', reading: 'üìö Reading', science: 'üî¨ Science', social: 'üë• Social' };
                if (areas) {
                    areas.innerHTML = Object.entries(this.state.progress.learningAreas).map(([key, value]) => {
                        const percent = Math.min(100, value * 10);
                        return `
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="font-semibold">${areaNames[key]}</span>
                                    <span class="text-sm text-gray-600">${value} activities</span>
                                </div>
                                <div class="w-full bg-white/50 rounded-full h-3">
                                    <div class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all" style="width: ${percent}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            },

            // Setup Achievements
            setupAchievements() {
                const grid = document.getElementById('badges-grid');
                if (grid) {
                    grid.innerHTML = this.badges.map(badge => {
                        const unlocked = this.checkBadgeUnlocked(badge);
                        return `
                            <div class="achievement-badge ${unlocked ? '' : 'locked'} ${this.isNewBadge(badge.id) ? 'new' : ''}" title="${badge.name}: ${badge.desc}">
                                ${badge.icon}
                            </div>
                        `;
                    }).join('');
                }
            },

            checkBadgeUnlocked(badge) {
                switch (badge.id) {
                    case 'first-game': return this.state.user.gamesPlayed >= 1;
                    case 'streak-3': return this.state.user.streak >= 3;
                    case 'streak-7': return this.state.user.streak >= 7;
                    case 'points-100': return this.state.user.points >= 100;
                    case 'points-500': return this.state.user.points >= 500;
                    case 'games-10': return this.state.user.gamesPlayed >= 10;
                    case 'math-10': return this.state.progress.learningAreas.math >= 10;
                    case 'words-10': return this.state.progress.learningAreas.reading >= 10;
                    default: return false;
                }
            },

            isNewBadge(badgeId) {
                return !this.state.achievements.includes(badgeId) && this.checkBadgeUnlocked(this.badges.find(b => b.id === badgeId));
            },

            // Setup Profile
            setupProfile() {
                document.getElementById('profile-name').textContent = this.state.user.name;
                document.getElementById('profile-age').textContent = `Age Group: ${this.state.ageGroup ? this.state.ageGroup.charAt(0).toUpperCase() + this.state.ageGroup.slice(1) : 'Not set'}`;
                document.getElementById('profile-level').textContent = this.state.user.level;
                document.getElementById('profile-exp').textContent = this.state.user.exp;
                document.getElementById('profile-exp-max').textContent = this.state.user.level * 100;
                document.getElementById('profile-exp-bar').style.width = (this.state.user.exp / (this.state.user.level * 100) * 100) + '%';

                // Toggle switches
                this.updateToggle('sound-toggle', this.state.soundEnabled);
                this.updateToggle('vibration-toggle', this.state.vibrationEnabled);
            },

            updateToggle(id, enabled) {
                const toggle = document.getElementById(id);
                if (toggle) {
                    toggle.className = `w-14 h-8 rounded-full ${enabled ? 'bg-indigo-500' : 'bg-gray-300'} relative transition-colors`;
                    toggle.querySelector('span').style.left = enabled ? '28px' : '4px';
                }
            },

            toggleSound() {
                this.state.soundEnabled = !this.state.soundEnabled;
                this.updateToggle('sound-toggle', this.state.soundEnabled);
                this.saveState();
            },

            toggleVibration() {
                this.state.vibrationEnabled = !this.state.vibrationEnabled;
                this.updateToggle('vibration-toggle', this.state.vibrationEnabled);
                this.saveState();
            },

            resetProgress() {
                if (confirm('Are you sure you want to reset all progress?')) {
                    localStorage.removeItem('athena-state');
                    location.reload();
                }
            },

            // Start Game
            startGame(gameId) {
                this.state.currentGame = gameId;
                this.state.view = gameId;
                this.state.user.gamesPlayed++;
                this.saveState();
                this.render();
                this.playSound('click');
            },

            exitGame() {
                this.state.currentGame = null;
                this.state.gameData = {};
                this.showView('games');
            },

            // ===== TEA PARTY GAME =====
            initTeaParty() {
                const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
                const items = ['üç™', 'üç∞', 'üßÅ', 'üçé', 'üçì', 'üçá'];
                const guests = ['Teddy', 'Robot', 'Doll'];

                this.state.gameData = {
                    tasks: this.generateTeaTasks(5, guests, colors, items),
                    currentTask: 0,
                    score: 0
                };

                this.renderTeaItems(colors, items);
                this.updateTeaTask();
            },

            generateTeaTasks(count, guests, colors, items) {
                const tasks = [];
                for (let i = 0; i < count; i++) {
                    tasks.push({
                        guest: guests[Math.floor(Math.random() * guests.length)],
                        color: colors[Math.floor(Math.random() * colors.length)],
                        item: items[Math.floor(Math.random() * items.length)],
                        count: Math.floor(Math.random() * 3) + 1
                    });
                }
                return tasks;
            },

            renderTeaItems(colors, items) {
                const container = document.getElementById('tea-items');
                if (!container) return;

                container.innerHTML = colors.flatMap(color => 
                    items.slice(0, 4).map(item => `
                        <button onclick="app.teaSelectItem('${color}', '${item}')" 
                                class="text-4xl p-3 bg-white/80 rounded-xl hover:scale-110 transition shadow-lg">
                            ${item}
                            <div class="text-xs font-bold mt-1" style="color: ${color};">${color}</div>
                        </button>
                    `)
                ).join('');
            },

            updateTeaTask() {
                const task = this.state.gameData.tasks[this.state.gameData.currentTask];
                
                if (!task) {
                    this.teaPartyComplete();
                    return;
                }

                document.getElementById('tea-task-text').textContent = 
                    `Give ${task.guest} ${task.count} ${task.color} ${task.item}!`;
                
                document.getElementById('tea-progress-text').textContent = 
                    `${this.state.gameData.currentTask}/${this.state.gameData.tasks.length}`;
                document.getElementById('tea-progress-bar').style.width = 
                    `${(this.state.gameData.currentTask / this.state.gameData.tasks.length) * 100}%`;

                // Clear order bubbles
                ['Teddy', 'Robot', 'Doll'].forEach(guest => {
                    const bubble = document.getElementById(`order-${guest.toLowerCase()}`);
                    if (bubble) bubble.textContent = '';
                });

                // Highlight current guest
                document.querySelectorAll('.chair').forEach(chair => {
                    chair.classList.remove('order-active');
                });
                const currentChair = document.getElementById(`chair-${task.guest.toLowerCase()}`);
                if (currentChair) {
                    currentChair.classList.add('order-active');
                }
            },

            teaPartyClickChair(guest) {
                const task = this.state.gameData.tasks[this.state.gameData.currentTask];
                if (!task) return;

                if (task.guest === guest) {
                    // Correct guest
                    const feedback = document.getElementById('tea-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-blue-100';
                    feedback.textContent = `‚úì ${guest} needs ${task.count} ${task.color} ${task.item}!`;
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 2000);
                } else {
                    // Wrong guest
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                    const feedback = document.getElementById('tea-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.textContent = `Not ${guest}'s turn! Look for the wiggling guest!`;
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 2000);
                }
            },

            teaSelectItem(color, item) {
                const task = this.state.gameData.tasks[this.state.gameData.currentTask];
                if (!task) return;

                if (color === task.color && item === task.item) {
                    // Correct!
                    this.state.gameData.score++;
                    this.playSound('success');
                    this.vibrate(100);

                    // Happy animation
                    const chair = document.getElementById(`chair-${task.guest.toLowerCase()}`);
                    if (chair) {
                        chair.classList.add('served');
                        setTimeout(() => chair.classList.remove('served'), 1000);
                    }

                    // Show order completed
                    const bubble = document.getElementById(`order-${task.guest.toLowerCase()}`);
                    if (bubble) {
                        bubble.textContent = `${task.count}x ${task.color} ${item} ‚úì`;
                    }

                    const feedback = document.getElementById('tea-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.textContent = `üéâ Perfect! ${task.guest} loves it!`;
                    feedback.classList.remove('hidden');

                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.state.gameData.currentTask++;
                        this.updateTeaTask();
                    }, 1500);
                } else {
                    // Incorrect
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                    const feedback = document.getElementById('tea-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.textContent = `Not quite! ${task.guest} wanted ${task.count} ${task.color} ${task.item}`;
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 2000);
                }
            },

            teaPartyComplete() {
                const points = this.state.gameData.score * 10;
                this.addPoints(points);
                this.addBrainConnections(3);
                this.state.progress.learningAreas.social++;
                this.state.progress.dailyChallenges++;
                
                // Update today's activity
                const today = new Date().getDay();
                this.state.progress.weeklyActivity[today]++;
                
                this.showSuccess('üéâ Party Complete!', `You earned ${points} stars!`, points);
                this.showConfetti();
                this.playSound('win');
                this.saveState();
            },

            // ===== TRACING GAME =====
            initTracing() {
                this.state.gameData = {
                    mode: 'number',
                    currentTrace: 5,
                    traceCount: 0
                };

                this.setupTraceCanvas();
                this.updateTraceTarget();

                // Highlight current mode
                document.querySelectorAll('.trace-mode-btn').forEach(btn => {
                    btn.classList.toggle('bg-indigo-500', btn.dataset.mode === 'number');
                    btn.classList.toggle('text-white', btn.dataset.mode === 'number');
                });
            },

            setTraceMode(mode) {
                this.state.gameData.mode = mode;
                document.querySelectorAll('.trace-mode-btn').forEach(btn => {
                    btn.classList.toggle('bg-indigo-500', btn.dataset.mode === mode);
                    btn.classList.toggle('text-white', btn.dataset.mode === mode);
                });
                this.updateTraceTarget();
                this.clearCanvas();
                this.playSound('click');
            },

            updateTraceTarget() {
                const { mode } = this.state.gameData;
                const target = document.getElementById('trace-target');
                
                if (mode === 'number') {
                    this.state.gameData.currentTrace = Math.floor(Math.random() * 9) + 1;
                    target.textContent = this.state.gameData.currentTrace;
                } else if (mode === 'letter') {
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                    this.state.gameData.currentTrace = letters[Math.floor(Math.random() * letters.length)];
                    target.textContent = this.state.gameData.currentTrace;
                } else if (mode === 'shape') {
                    const shapes = ['‚óã', '‚ñ°', '‚ñ≥', '‚òÜ'];
                    this.state.gameData.currentTrace = shapes[Math.floor(Math.random() * shapes.length)];
                    target.textContent = this.state.gameData.currentTrace;
                    target.style.fontSize = '150px';
                } else if (mode === 'word') {
                    const words = ['CAT', 'DOG', 'SUN', 'MOON', 'STAR'];
                    this.state.gameData.currentTrace = words[Math.floor(Math.random() * words.length)];
                    target.textContent = this.state.gameData.currentTrace;
                    target.style.fontSize = '60px';
                }

                document.getElementById('trace-count').textContent = this.state.gameData.traceCount;
            },

            setupTraceCanvas() {
                const canvas = document.getElementById('trace-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                let isDrawing = false;
                let lastX = 0;
                let lastY = 0;
                let drawnPixels = 0;

                const getPos = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                    const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
                    return { x, y };
                };

                const startDraw = (e) => {
                    isDrawing = true;
                    const pos = getPos(e);
                    lastX = pos.x;
                    lastY = pos.y;
                    this.playSound('click');
                };

                const draw = (e) => {
                    if (!isDrawing) return;
                    e.preventDefault();
                    
                    const pos = getPos(e);
                    
                    ctx.strokeStyle = '#6366f1';
                    ctx.lineWidth = 8;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(pos.x, pos.y);
                    ctx.stroke();

                    lastX = pos.x;
                    lastY = pos.y;
                    drawnPixels++;
                };

                const stopDraw = () => {
                    isDrawing = false;
                };

                canvas.addEventListener('mousedown', startDraw);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDraw);
                canvas.addEventListener('mouseout', stopDraw);

                canvas.addEventListener('touchstart', startDraw);
                canvas.addEventListener('touchmove', draw);
                canvas.addEventListener('touchend', stopDraw);

                this.state.gameData.drawnPixels = 0;
            },

            clearCanvas() {
                const canvas = document.getElementById('trace-canvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
                const feedback = document.getElementById('trace-feedback');
                if (feedback) feedback.classList.add('hidden');
            },

            checkTracing() {
                const canvas = document.getElementById('trace-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const pixels = imageData.data;
                let drawnPixels = 0;
                
                for (let i = 0; i < pixels.length; i += 4) {
                    if (pixels[i] > 0) drawnPixels++;
                }

                const feedback = document.getElementById('trace-feedback');
                
                if (drawnPixels > 500) {
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.textContent = 'üéâ Great tracing! Keep it up!';
                    feedback.classList.remove('hidden');
                    
                    this.state.gameData.traceCount++;
                    this.addPoints(5);
                    this.addBrainConnections(1);
                    this.playSound('success');
                    this.vibrate(100);
                    this.saveState();
                } else {
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.textContent = '‚úèÔ∏è Draw more lines to complete the trace!';
                    feedback.classList.remove('hidden');
                    this.playSound('error');
                }
            },

            nextTrace() {
                this.updateTraceTarget();
                this.clearCanvas();
                this.playSound('click');
            },

            // ===== SHAPES GAME =====
            initShapes() {
                this.state.gameData = {
                    correct: 0,
                    total: 0,
                    currentTarget: 'circle'
                };
                this.renderShapes();
            },

            renderShapes() {
                const shapes = [
                    { id: 'circle', emoji: '‚≠ï', name: 'Circle', color: 'from-red-400 to-pink-400' },
                    { id: 'square', emoji: '‚¨ú', name: 'Square', color: 'from-blue-400 to-cyan-400' },
                    { id: 'triangle', emoji: 'üî∫', name: 'Triangle', color: 'from-green-400 to-emerald-400' },
                    { id: 'star', emoji: '‚≠ê', name: 'Star', color: 'from-yellow-400 to-orange-400' },
                    { id: 'heart', emoji: '‚ù§Ô∏è', name: 'Heart', color: 'from-pink-400 to-red-400' },
                    { id: 'diamond', emoji: 'üíé', name: 'Diamond', color: 'from-purple-400 to-violet-400' }
                ];

                // Shuffle
                const shuffled = [...shapes].sort(() => Math.random() - 0.5);
                this.state.gameData.currentTarget = shuffled[Math.floor(Math.random() * 3)].id;

                const target = shapes.find(s => s.id === this.state.gameData.currentTarget);
                document.getElementById('shapes-instruction').innerHTML = 
                    `Find the <span class="font-black">${target.emoji} ${target.name}!</span>`;

                const grid = document.getElementById('shapes-grid');
                if (grid) {
                    grid.innerHTML = shuffled.map(shape => `
                        <div class="shape-card bg-gradient-to-br ${shape.color}" onclick="app.checkShape('${shape.id}')">
                            ${shape.emoji}
                        </div>
                    `).join('');
                }

                document.getElementById('shapes-correct').textContent = this.state.gameData.correct;
                document.getElementById('shapes-total').textContent = this.state.gameData.total;
            },

            checkShape(shapeId) {
                this.state.gameData.total++;
                
                if (shapeId === this.state.gameData.currentTarget) {
                    this.state.gameData.correct++;
                    this.addPoints(10);
                    this.addBrainConnections(1);
                    this.playSound('success');
                    this.vibrate(100);
                    
                    const feedback = document.getElementById('shapes-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Correct!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 1000);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                    
                    const feedback = document.getElementById('shapes-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.innerHTML = '<span class="text-4xl wiggle">üí™</span><br>Try again!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 1000);
                }

                this.renderShapes();
            },

            // ===== NUMBERS GAME =====
            initNumbers() {
                this.state.gameData = {
                    targetNumber: Math.floor(Math.random() * 9) + 1
                };
                this.renderNumbers();
            },

            renderNumbers() {
                const numbers = Array.from({ length: 9 }, (_, i) => i + 1);
                const shuffled = [...numbers].sort(() => Math.random() - 0.5);

                document.getElementById('numbers-instruction').textContent = 
                    `Find the number ${this.state.gameData.targetNumber}!`;

                const grid = document.getElementById('numbers-grid');
                if (grid) {
                    grid.innerHTML = shuffled.map(num => `
                        <div class="number-card" onclick="app.checkNumber(${num})">${num}</div>
                    `).join('');
                }
            },

            checkNumber(num) {
                if (num === this.state.gameData.targetNumber) {
                    this.addPoints(8);
                    this.addBrainConnections(1);
                    this.state.progress.learningAreas.math++;
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('numbers-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Correct!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.state.gameData.targetNumber = Math.floor(Math.random() * 9) + 1;
                        this.renderNumbers();
                    }, 1000);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                }
            },

            // ===== LETTERS GAME =====
            initLetters() {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                this.state.gameData = {
                    targetLetter: letters[Math.floor(Math.random() * letters.length)]
                };
                this.renderLetters();
            },

            renderLetters() {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                const shuffled = [...letters].sort(() => Math.random() - 0.5).slice(0, 12);
                shuffled.push(this.state.gameData.targetLetter);
                shuffled.sort(() => Math.random() - 0.5);

                document.getElementById('letters-instruction').textContent = 
                    `Find the letter ${this.state.gameData.targetLetter}!`;

                const grid = document.getElementById('letters-grid');
                if (grid) {
                    grid.innerHTML = shuffled.map(letter => `
                        <div class="letter-card" onclick="app.checkLetter('${letter}')">${letter}</div>
                    `).join('');
                }
            },

            checkLetter(letter) {
                if (letter === this.state.gameData.targetLetter) {
                    this.addPoints(8);
                    this.addBrainConnections(1);
                    this.state.progress.learningAreas.reading++;
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('letters-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Correct!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                        this.state.gameData.targetLetter = letters[Math.floor(Math.random() * letters.length)];
                        this.renderLetters();
                    }, 1000);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                }
            },

            // ===== WORD BUILDER GAME =====
            initWords() {
                const words = [
                    { word: 'CAT', image: 'üê±' },
                    { word: 'DOG', image: 'üêï' },
                    { word: 'SUN', image: '‚òÄÔ∏è' },
                    { word: 'MOON', image: 'üåô' },
                    { word: 'STAR', image: '‚≠ê' },
                    { word: 'TREE', image: 'üå≥' },
                    { word: 'FISH', image: 'üêü' },
                    { word: 'BIRD', image: 'üê¶' }
                ];

                const wordObj = words[Math.floor(Math.random() * words.length)];
                this.state.gameData = {
                    targetWord: wordObj.word,
                    image: wordObj.image,
                    currentAnswer: []
                };

                document.getElementById('word-image').textContent = wordObj.image;

                const letters = wordObj.word.split('');
                const extraLetters = 'XYZ'.split('');
                const allLetters = [...letters, ...extraLetters].sort(() => Math.random() - 0.5);

                const slots = document.getElementById('word-slots');
                if (slots) {
                    slots.innerHTML = letters.map(() => `
                        <div class="letter-slot" data-index="${letters.length}"></div>
                    `).join('');
                }

                const letterTiles = document.getElementById('word-letters');
                if (letterTiles) {
                    letterTiles.innerHTML = allLetters.map((letter, i) => `
                        <div class="letter-tile" data-letter="${letter}" onclick="app.selectLetter('${letter}', ${i})">${letter}</div>
                    `).join('');
                }
            },

            selectLetter(letter, index) {
                const word = this.state.gameData.targetWord;
                
                if (this.state.gameData.currentAnswer.length < word.length) {
                    this.state.gameData.currentAnswer.push(letter);
                    
                    // Update slot
                    const slots = document.querySelectorAll('.letter-slot');
                    const slotIndex = this.state.gameData.currentAnswer.length - 1;
                    if (slots[slotIndex]) {
                        slots[slotIndex].textContent = letter;
                        slots[slotIndex].classList.add('filled');
                    }

                    // Mark tile as used
                    const tiles = document.querySelectorAll('.letter-tile');
                    tiles.forEach(tile => {
                        if (tile.dataset.letter === letter && !tile.classList.contains('used')) {
                            tile.classList.add('used');
                            return;
                        }
                    });

                    this.playSound('click');
                }
            },

            resetWord() {
                this.state.gameData.currentAnswer = [];
                document.querySelectorAll('.letter-slot').forEach(slot => {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                });
                document.querySelectorAll('.letter-tile').forEach(tile => {
                    tile.classList.remove('used');
                });
                this.playSound('click');
            },

            checkWord() {
                const answer = this.state.gameData.currentAnswer.join('');
                const target = this.state.gameData.targetWord;

                if (answer === target) {
                    this.addPoints(15);
                    this.addBrainConnections(2);
                    this.state.progress.learningAreas.reading++;
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('words-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Great spelling!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.initWords();
                    }, 1500);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                    const feedback = document.getElementById('words-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.textContent = `Not quite! Try again!`;
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 1500);
                    this.resetWord();
                }
            },

            // ===== MATH GAME =====
            initMath() {
                const num1 = Math.floor(Math.random() * 5) + 1;
                const num2 = Math.floor(Math.random() * 5) + 1;
                const answer = num1 + num2;

                this.state.gameData = {
                    num1,
                    num2,
                    answer,
                    fruits: ['üçé', 'üçä', 'üçã', 'üçá', 'üçì', 'üçí']
                };

                document.getElementById('math-problem').textContent = `${num1} + ${num2} = ?`;

                // Show fruits to count
                const fruitsContainer = document.getElementById('math-fruits');
                if (fruitsContainer) {
                    const fruitEmoji = this.state.gameData.fruits[Math.floor(Math.random() * this.state.gameData.fruits.length)];
                    let fruitsHtml = '';
                    for (let i = 0; i < num1; i++) fruitsHtml += `<span class="math-fruit">${fruitEmoji}</span>`;
                    fruitsHtml += '<span class="text-2xl">+</span>';
                    for (let i = 0; i < num2; i++) fruitsHtml += `<span class="math-fruit">${fruitEmoji}</span>`;
                    fruitsContainer.innerHTML = fruitsHtml;
                }

                // Answer options
                const options = [answer];
                while (options.length < 3) {
                    const wrong = answer + Math.floor(Math.random() * 5) - 2;
                    if (wrong !== answer && wrong > 0 && !options.includes(wrong)) {
                        options.push(wrong);
                    }
                }
                options.sort(() => Math.random() - 0.5);

                const answersContainer = document.getElementById('math-answers');
                if (answersContainer) {
                    answersContainer.innerHTML = options.map(opt => `
                        <button onclick="app.checkMath(${opt})" class="btn-secondary w-full">${opt}</button>
                    `).join('');
                }
            },

            checkMath(selected) {
                if (selected === this.state.gameData.answer) {
                    this.addPoints(12);
                    this.addBrainConnections(2);
                    this.state.progress.learningAreas.math++;
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('math-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Correct!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.initMath();
                    }, 1000);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                }
            },

            // ===== COLORS GAME =====
            initColors() {
                const colors = [
                    { name: 'RED', value: '#ef4444', emoji: 'üî¥' },
                    { name: 'BLUE', value: '#3b82f6', emoji: 'üîµ' },
                    { name: 'GREEN', value: '#22c55e', emoji: 'üü¢' },
                    { name: 'YELLOW', value: '#eab308', emoji: 'üü°' },
                    { name: 'PURPLE', value: '#a855f7', emoji: 'üü£' },
                    { name: 'ORANGE', value: '#f97316', emoji: 'üü†' }
                ];

                const targetColor = colors[Math.floor(Math.random() * colors.length)];
                this.state.gameData = { targetColor };

                document.getElementById('color-target-name').textContent = targetColor.name;
                document.getElementById('color-target-name').style.color = targetColor.value;

                const grid = document.getElementById('colors-grid');
                if (grid) {
                    grid.innerHTML = colors.map(color => `
                        <div class="color-bubble" style="background-color: ${color.value};" onclick="app.checkColor('${color.name}')">
                            ${color.emoji}
                        </div>
                    `).join('');
                }
            },

            checkColor(colorName) {
                if (colorName === this.state.gameData.targetColor.name) {
                    this.addPoints(8);
                    this.addBrainConnections(1);
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('colors-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Correct!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.initColors();
                    }, 1000);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                }
            },

            // ===== MEMORY GAME =====
            initMemory() {
                const emojis = ['üåü', 'üéà', 'üéÄ', 'ü¶ã', 'üåà', 'üçÄ', 'üé∏', 'üöÄ'];
                const cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);

                this.state.gameData = {
                    cards,
                    flipped: [],
                    matched: [],
                    moves: 0
                };

                this.renderMemoryCards();
            },

            renderMemoryCards() {
                const grid = document.getElementById('memory-grid');
                if (!grid) return;

                grid.innerHTML = this.state.gameData.cards.map((emoji, i) => `
                    <div class="flip-card" onclick="app.flipCard(${i})" data-index="${i}">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">?</div>
                            <div class="flip-card-back">${emoji}</div>
                        </div>
                    </div>
                `).join('');

                document.getElementById('memory-moves').textContent = this.state.gameData.moves;
            },

            flipCard(index) {
                const flipped = this.state.gameData.flipped;
                const matched = this.state.gameData.matched;

                if (flipped.length >= 2 || flipped.includes(index) || matched.includes(index)) return;

                flipped.push(index);
                this.playSound('click');

                const card = document.querySelector(`.flip-card[data-index="${index}"]`);
                if (card) card.classList.add('flipped');

                if (flipped.length === 2) {
                    this.state.gameData.moves++;
                    document.getElementById('memory-moves').textContent = this.state.gameData.moves;

                    const [first, second] = flipped;
                    if (this.state.gameData.cards[first] === this.state.gameData.cards[second]) {
                        // Match!
                        matched.push(first, second);
                        this.state.gameData.flipped = [];
                        this.playSound('success');
                        this.vibrate(100);

                        if (matched.length === this.state.gameData.cards.length) {
                            setTimeout(() => {
                                this.addPoints(25);
                                this.addBrainConnections(3);
                                this.showSuccess('üß† Memory Master!', `You won in ${this.state.gameData.moves} moves!`, 25);
                                this.showConfetti();
                                this.playSound('win');
                            }, 500);
                        }
                    } else {
                        // No match
                        setTimeout(() => {
                            document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
                            this.state.gameData.flipped = [];
                            this.playSound('error');
                            this.vibrate([50, 50, 50]);
                        }, 1000);
                    }
                }
            },

            restartMemory() {
                this.initMemory();
                this.playSound('click');
            },

            // ===== PUZZLE GAME =====
            initPuzzle() {
                const emojis = ['üåà', '‚≠ê', 'üéà', '‚ù§Ô∏è', 'üöÄ', 'ü¶ã', 'üå∏', 'üéÄ'];
                const puzzleEmojis = emojis.slice(0, 5);
                const pieces = [...puzzleEmojis].sort(() => Math.random() - 0.5);

                this.state.gameData = {
                    target: puzzleEmojis,
                    pieces,
                    placed: Array(5).fill(null),
                    startTime: Date.now()
                };

                document.getElementById('puzzle-target').textContent = puzzleEmojis.join('');

                const piecesContainer = document.getElementById('puzzle-pieces');
                if (piecesContainer) {
                    piecesContainer.innerHTML = pieces.map((emoji, i) => `
                        <div class="puzzle-piece" data-emoji="${emoji}" onclick="app.selectPuzzlePiece('${emoji}')">${emoji}</div>
                    `).join('');
                }

                const slotsContainer = document.getElementById('puzzle-slots');
                if (slotsContainer) {
                    slotsContainer.innerHTML = puzzleEmojis.map((_, i) => `
                        <div class="puzzle-slot" data-index="${i}" onclick="app.placePuzzlePiece(${i})">?</div>
                    `).join('');
                }

                // Timer
                this.state.gameData.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.state.gameData.startTime) / 1000);
                    const mins = Math.floor(elapsed / 60);
                    const secs = elapsed % 60;
                    const timeEl = document.getElementById('puzzle-time');
                    if (timeEl) timeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                }, 1000);
            },

            selectedPiece: null,

            selectPuzzlePiece(emoji) {
                document.querySelectorAll('.puzzle-piece').forEach(p => p.classList.remove('selected'));
                this.selectedPiece = emoji;
                const piece = document.querySelector(`.puzzle-piece[data-emoji="${emoji}"]`);
                if (piece) piece.classList.add('selected');
                this.playSound('click');
            },

            placePuzzlePiece(index) {
                if (!this.selectedPiece) return;

                const slot = document.querySelector(`.puzzle-slot[data-index="${index}"]`);
                if (slot && !slot.classList.contains('filled')) {
                    slot.textContent = this.selectedPiece;
                    slot.classList.add('filled');
                    this.state.gameData.placed[index] = this.selectedPiece;

                    const piece = document.querySelector(`.puzzle-piece[data-emoji="${this.selectedPiece}"]`);
                    if (piece) {
                        piece.style.visibility = 'hidden';
                    }

                    this.selectedPiece = null;
                    this.playSound('click');

                    // Check if complete
                    if (this.state.gameData.placed.every(p => p !== null)) {
                        const correct = this.state.gameData.placed.every((p, i) => 
                            p === this.state.gameData.target[i]
                        );

                        if (correct) {
                            clearInterval(this.state.gameData.timerInterval);
                            this.addPoints(20);
                            this.addBrainConnections(2);
                            this.showSuccess('üß© Puzzle Complete!', 'Great pattern recognition!', 20);
                            this.showConfetti();
                            this.playSound('win');
                        }
                    }
                }
            },

            resetPuzzle() {
                clearInterval(this.state.gameData.timerInterval);
                this.initPuzzle();
                this.playSound('click');
            },

            // ===== PATTERNS GAME =====
            initPatterns() {
                const patterns = [
                    { sequence: ['üî¥', 'üîµ', 'üî¥', 'üîµ'], answer: 'üî¥', options: ['üî¥', 'üîµ', 'üü¢'] },
                    { sequence: ['‚≠ê', '‚≠ê', 'üåô', '‚≠ê', '‚≠ê'], answer: 'üåô', options: ['‚≠ê', 'üåô', 'üåà'] },
                    { sequence: ['üçé', 'üçä', 'üçé', 'üçä'], answer: 'üçé', options: ['üçé', 'üçä', 'üçã'] },
                    { sequence: ['üéà', 'üéà', 'üéà', 'üéÄ'], answer: 'üéà', options: ['üéà', 'üéÄ', 'üéÅ'] },
                    { sequence: ['üå∏', 'ü¶ã', 'üå∏', 'ü¶ã', 'üå∏'], answer: 'ü¶ã', options: ['üå∏', 'ü¶ã', 'üêù'] }
                ];

                const pattern = patterns[Math.floor(Math.random() * patterns.length)];
                this.state.gameData = { pattern };

                const display = document.getElementById('pattern-display');
                if (display) {
                    display.innerHTML = [
                        ...pattern.sequence.map(emoji => `<span class="text-4xl">${emoji}</span>`),
                        '<span class="text-4xl text-gray-400">?</span>'
                    ].join('');
                }

                const options = document.getElementById('pattern-options');
                if (options) {
                    options.innerHTML = pattern.options.map(emoji => `
                        <button onclick="app.checkPattern('${emoji}', '${pattern.answer}')" class="text-5xl p-4 bg-white/80 rounded-2xl hover:scale-110 transition shadow-lg">
                            ${emoji}
                        </button>
                    `).join('');
                }
            },

            checkPattern(selected, correct) {
                if (selected === correct) {
                    this.addPoints(15);
                    this.addBrainConnections(2);
                    this.playSound('success');
                    this.vibrate(100);
                    this.showConfetti();
                    
                    const feedback = document.getElementById('patterns-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-green-100';
                    feedback.innerHTML = '<span class="text-4xl bounce">üéâ</span><br>Perfect pattern!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        this.initPatterns();
                    }, 1500);
                } else {
                    this.playSound('error');
                    this.vibrate([50, 50, 50]);
                    const feedback = document.getElementById('patterns-feedback');
                    feedback.className = 'mt-4 p-4 rounded-2xl text-center bg-orange-100';
                    feedback.innerHTML = '<span class="text-4xl wiggle">üí™</span><br>Look at the pattern again!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => feedback.classList.add('hidden'), 1500);
                }
            },

            // ===== POTTY TRAINING GAME =====
            initPotty() {
                this.state.gameData = {
                    step: 1,
                    wipes: 0,
                    timer: 0,
                    timerInterval: null
                };

                // Reset UI
                document.getElementById('potty-step-1').classList.remove('hidden');
                document.getElementById('potty-step-2').classList.add('hidden');
                document.getElementById('potty-step-3').classList.add('hidden');
                document.getElementById('potty-step-4').classList.add('hidden');
                document.getElementById('potty-success').classList.add('hidden');

                // Reset avatar
                const avatar = document.querySelector('.avatar-head');
                if (avatar) {
                    avatar.classList.add('needs-potty');
                    avatar.classList.remove('happy');
                }
            },

            pottyGo() {
                this.state.gameData.step = 2;
                document.getElementById('potty-step-1').classList.add('hidden');
                document.getElementById('potty-step-2').classList.remove('hidden');
                this.playSound('success');
                this.vibrate(100);
            },

            pottyFlush() {
                const water = document.getElementById('toilet-water');
                if (water) {
                    water.classList.add('flushing');
                    this.playSound('flush');
                    this.vibrate([30, 50, 30]);
                    
                    // Create flush particles
                    const particles = document.getElementById('flush-particles');
                    if (particles) {
                        for (let i = 0; i < 10; i++) {
                            const particle = document.createElement('div');
                            particle.className = 'water-particle';
                            particle.style.left = Math.random() * 100 + '%';
                            particle.style.animationDelay = Math.random() * 0.5 + 's';
                            particles.appendChild(particle);
                            setTimeout(() => particle.remove(), 1000);
                        }
                    }

                    setTimeout(() => {
                        water.classList.remove('flushing');
                    }, 2000);
                }
            },

            pottyWipe() {
                this.state.gameData.wipes++;
                document.getElementById('potty-wipes').textContent = this.state.gameData.wipes;
                this.playSound('click');
                this.vibrate(50);
            },

            pottyWash() {
                this.playSound('click');
                // Add soap bubbles
                const bubbles = document.getElementById('soap-bubbles');
                if (bubbles) {
                    for (let i = 0; i < 5; i++) {
                        const bubble = document.createElement('div');
                        bubble.className = 'soap-bubble';
                        const size = Math.random() * 20 + 10;
                        bubble.style.width = size + 'px';
                        bubble.style.height = size + 'px';
                        bubble.style.left = Math.random() * 100 + '%';
                        bubble.style.bottom = '0';
                        bubbles.appendChild(bubble);
                        setTimeout(() => bubble.remove(), 2000);
                    }
                }
            },

            pottyWater() {
                const stream = document.getElementById('water-stream');
                const sinkWater = document.getElementById('sink-water');
                
                if (stream && sinkWater) {
                    stream.classList.toggle('flowing');
                    sinkWater.classList.toggle('running');
                    
                    if (stream.classList.contains('flowing')) {
                        this.playSound('water');
                        
                        if (!this.state.gameData.timerInterval) {
                            this.state.gameData.timerInterval = setInterval(() => {
                                this.state.gameData.timer++;
                                document.getElementById('potty-timer').textContent = this.state.gameData.timer;
                            }, 1000);
                        }
                    } else {
                        if (this.audioCtx) {
                            // Stop water sound
                        }
                    }
                }
            },

            pottyNext() {
                this.state.gameData.step++;
                
                document.getElementById('potty-step-2').classList.add('hidden');
                document.getElementById('potty-step-3').classList.remove('hidden');
                
                setTimeout(() => {
                    document.getElementById('potty-step-3').classList.add('hidden');
                    document.getElementById('potty-step-4').classList.remove('hidden');
                }, 500);
            },

            pottyComplete() {
                clearInterval(this.state.gameData.timerInterval);
                
                document.getElementById('potty-step-4').classList.add('hidden');
                document.getElementById('potty-success').classList.remove('hidden');

                // Happy avatar
                const avatar = document.querySelector('.avatar-head');
                if (avatar) {
                    avatar.classList.remove('needs-potty');
                    avatar.classList.add('happy');
                }

                this.addPoints(20);
                this.addBrainConnections(3);
                this.state.progress.dailyChallenges++;
                this.playSound('win');
                this.vibrate([100, 50, 100]);
                this.showConfetti();
                this.saveState();
            },

            // ===== UTILITY FUNCTIONS =====
            addPoints(points) {
                this.state.user.points += points;
                this.state.user.exp += points;
                
                // Level up check
                const expNeeded = this.state.user.level * 100;
                if (this.state.user.exp >= expNeeded) {
                    this.state.user.level++;
                    this.state.user.exp -= expNeeded;
                    this.showSuccess('üéâ Level Up!', `You are now level ${this.state.user.level}!`, 0);
                }

                document.getElementById('points-display').textContent = this.state.user.points;
                this.saveState();
            },

            addBrainConnections(count) {
                this.state.user.brainConnections += count;
                this.saveState();
            },

            showSuccess(title, message, points) {
                const template = document.getElementById('template-success-modal');
                if (!template) return;

                const existing = document.getElementById('success-modal-overlay');
                if (existing) existing.remove();

                document.body.appendChild(template.content.cloneNode(true));

                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-message').textContent = message;
                document.getElementById('modal-icon').textContent = title.includes('Complete') || title.includes('Master') || title.includes('Up') ? 'üéâ' : '‚≠ê';
                
                if (points > 0) {
                    document.getElementById('modal-points').classList.remove('hidden');
                    document.getElementById('modal-points-value').textContent = '+' + points;
                } else {
                    document.getElementById('modal-points').classList.add('hidden');
                }
            },

            closeModal() {
                const modal = document.getElementById('success-modal-overlay');
                if (modal) modal.remove();
            },

            showConfetti() {
                const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da'];
                const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];

                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    if (Math.random() > 0.5) {
                        confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        confetti.style.fontSize = (Math.random() * 20 + 15) + 'px';
                    } else {
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.width = (Math.random() * 10 + 5) + 'px';
                        confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    }
                    
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }
            }
        };

        // Initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => app.init());
        } else {
            app.init();
        }

        // Handle back button
        window.addEventListener('popstate', () => {
            if (app.state.currentGame) {
                app.exitGame();
            }
        });
    </script>
</body>
</html>
